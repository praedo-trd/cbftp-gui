"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function live(a,b,c){document.addEventListener(a,function(a){var d=document.querySelectorAll(b);if(d){for(var e=a.target,f=-1;e&&-1===(f=Array.prototype.indexOf.call(d,e));)e=e.parentElement;f>-1&&c.call(e,a)}})}function showHelp(a){window.fetch("/api/doc/parse/"+a).then(function(a){return a.text()}).then(function(a){document.querySelector("#help .content").innerHTML=a,document.querySelector("#help").classList.add("visible")})}function hideHelp(a){document.querySelector("#help").classList.remove("visible"),a.preventDefault()}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),AutoRules=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={rules:[],schedule:{1:["00:00","23:59"],2:["00:00","23:59"],3:["00:00","23:59"],4:["00:00","23:59"],5:["00:00","23:59"],6:["00:00","23:59"],7:["00:00","23:59"]},loaded:!1},c}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this;fetch("/api/autorules",{method:"get"}).then(function(b){return b.json().then(function(b){console.log(b),a.setState({rules:b.rules,schedule:b.schedule,loaded:!0})})})["catch"](function(a){})}},{key:"onChangeRules",value:function(a){var b=JSON.parse(JSON.stringify(this.state.rules)),c=_.without(a.trim().split("\n"),"");_.set(b,"rules",c),this.setState({rules:b.rules})}},{key:"componentDidUpdate",value:function(a,b){if(b.loaded!==!1){var c=new FormData;c.append("rules",this.state.rules),fetch("/api/autorules/save",{method:"POST",body:JSON.stringify({rules:this.state.rules,schedule:this.state.schedule}),headers:new Headers({"Content-Type":"application/json"})}).then(function(a){return a.json()}).then(function(a){console.log(a)})}}},{key:"onChangeSchedule",value:function(a,b,c){var d=jQuery.extend(!0,{},this.state.schedule),d=JSON.parse(JSON.stringify(this.state.schedule));_.set(d,a+".["+b+"]",c.target.value),console.log(d),this.setState({schedule:d})}},{key:"render",value:function(){var a=this;if(!this.state.loaded)return React.createElement("p",null,"Loading...");var b="";"undefined"!=typeof this.state.rules&&(b=this.state.rules.join("\n"));var c=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(b,c){return React.createElement("tr",{key:b},React.createElement("td",null,b),React.createElement("td",null,React.createElement("input",{onChange:a.onChangeSchedule.bind(a,c+1,0),type:"text",className:"form-control input-sm",style:{width:"70px",marginRight:0},defaultValue:a.state.schedule[c+1][0]})," -",React.createElement("input",{onChange:a.onChangeSchedule.bind(a,c+1,1),type:"text",className:"form-control input-sm",style:{width:"70px"},defaultValue:a.state.schedule[c+1][1]})))});return React.createElement("div",{className:"well"},React.createElement("h3",null,"Autotrading Rules"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3 form-inline"},React.createElement("p",null,"Schedule:"),React.createElement("table",{className:"table table-bordered"},React.createElement("tbody",null,c))),React.createElement("div",{className:"col-md-9"},React.createElement("p",null,"One rule per line"),React.createElement("div",{className:"form-group"},React.createElement(RulesEditor,{key:"rules",defaultValue:b,onChange:this.onChangeRules.bind(this)})),React.createElement("div",{className:"alert alert-warning"},"You can use the special variable ",React.createElement("code",null,"[chain]")," only on this page to write auto rules based on which sites are in the chain."))))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),AutoSettings=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.classifications=["Animation","Award Show","Documentary","Game Show","News","Reality","Scripted","Sports","Talk Show","Variety"],c.countries=["United States","Canada","United Kingdom","Australia","New Zealand","Denmark","Norway","Sweden"],c.state={setClassifications:[],setCountries:[],loaded:!1},c}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this;fetch("/api/auto/settings/"+this.props.section,{method:"get"}).then(function(b){return b.json().then(function(b){a.setState({setClassifications:b.allowed_classifications,setCountries:b.allowed_countries,loaded:!0})})})["catch"](function(a){})}},{key:"onChangeAllowedClassifications",value:function(a){var b=this.state.setClassifications||[],c=a.target.value;a.target.checked?(b.push(c),b.sort()):_.remove(b,function(a){return a===c}),this.setState({setClassifications:b})}},{key:"onChangeAllowedCountries",value:function(a){var b=this.state.setCountries||[],c=a.target.value;a.target.checked?(b.push(c),b.sort()):_.remove(b,function(a){return a===c}),this.setState({setCountries:b})}},{key:"componentDidUpdate",value:function(a,b){if(b.loaded!==!1){var c=new FormData;c.append("allowed_classifications",this.state.setClassifications),c.append("allowed_countries",this.state.setCountries),fetch("/api/auto/settings/"+this.props.section,{method:"POST",body:c}).then(function(a){return a.json()}).then(function(a){console.log(a)})}}},{key:"render",value:function(){var a=this;return React.createElement("div",{className:"well"},React.createElement("h3",null,"Settings"),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label"},"Allowed classifications:"),React.createElement("br",null),a.classifications.map(function(b){var c=!1;return a.state.setClassifications.indexOf(b)>-1&&(c=!0),React.createElement("label",{className:"checkbox-inline",key:b},React.createElement("input",{onClick:a.onChangeAllowedClassifications.bind(a),type:"checkbox",value:b,checked:c})," ",b)})),React.createElement("div",{className:"form-group"},React.createElement("label",{className:"control-label"},"Allowed countries:"),React.createElement("br",null),a.countries.map(function(b){var c=!1;return a.state.setCountries.indexOf(b)>-1&&(c=!0),React.createElement("label",{className:"checkbox-inline",key:b},React.createElement("input",{onClick:a.onChangeAllowedCountries.bind(a),type:"checkbox",value:b,checked:c})," ",b)})))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),InputBooleanChoice=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={selectedOption:c.props.defaultValue},c}return _inherits(b,a),_createClass(b,[{key:"handleOptionChange",value:function(a){var b="true"==a.target.value;this.setState({selectedOption:b}),this.props.onChange(this.props.name,a)}},{key:"render",value:function(){return React.createElement("div",{className:"form-group"},React.createElement("label",{className:"col-sm-3 control-label"},this.props.label),React.createElement("div",{className:"col-sm-9"},React.createElement("label",{className:"radio-inline"},React.createElement("input",{name:this.props.name,type:"radio",value:"true",checked:1==this.state.selectedOption,onChange:this.handleOptionChange.bind(this)}),"True"),React.createElement("label",{className:"radio-inline"},React.createElement("input",{name:this.props.name,type:"radio",value:"false",checked:0==this.state.selectedOption,onChange:this.handleOptionChange.bind(this)}),"False")))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),InputTagOption=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,[{key:"handleChange",value:function(a){this.props.onChange(this.props.name,a)}},{key:"onChangeSetting",value:function(a,b){this.props.onChange("tag_options."+this.props.tag+"."+a,b)}},{key:"render",value:function(){var a=[];this.props.info.data_sources&&(a=this.props.info.data_sources.sort().join(" "));var b=[];this.props.info.allowed_groups&&(b=this.props.info.allowed_groups.sort().join(" "));var c=[];this.props.info.tag_requires&&(c=this.props.info.tag_requires.sort().join("\n"));var d=[];return this.props.info.tag_skiplist&&(d=this.props.info.tag_skiplist.sort().join("\n")),React.createElement("div",null,React.createElement(InputText,{name:"data_sources",label:"Data providers (space-seperator)",description:"Bla bla",defaultValue:a,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputText,{name:"allowed_groups",label:"Allowed groups (space-seperator",description:"Bla bla",defaultValue:b,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputTextarea,{name:"tag_requires",label:"Tag requires (one regex p/line)",description:"Bla bla",defaultValue:c,onChange:this.onChangeSetting.bind(this),rows:10,classes:"code"}),React.createElement(InputTextarea,{name:"tag_skiplist",label:"Tag skiplist (one regex p/line)",description:"Bla bla",defaultValue:d,onChange:this.onChangeSetting.bind(this),rows:10,classes:"code"}))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),InputText=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,[{key:"handleChange",value:function(a){this.props.onChange(this.props.name,a)}},{key:"render",value:function(){var a=classNames("form-control",this.props.classes);return React.createElement("div",{className:"form-group"},React.createElement("label",{className:"col-sm-3 control-label"},this.props.label),React.createElement("div",{className:"col-sm-9"},React.createElement("input",{name:this.props.name,type:"text",className:a,defaultValue:this.props.defaultValue,onChange:this.handleChange.bind(this)})))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),InputTextarea=function(a){function b(a){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),_createClass(b,[{key:"handleChange",value:function(a){this.props.onChange(this.props.name,a)}},{key:"render",value:function(){var a=classNames("form-control",this.props.classes);return this.props.label?React.createElement("div",{className:"form-group"},React.createElement("label",{className:"col-sm-3 control-label"},this.props.label),React.createElement("div",{className:"col-sm-9"},React.createElement("textarea",{name:this.props.name,className:a,defaultValue:this.props.defaultValue,onChange:this.handleChange.bind(this),rows:this.props.rows}))):React.createElement("div",{className:"form-group"},React.createElement("textarea",{name:this.props.name,className:a,defaultValue:this.props.defaultValue,onChange:this.handleChange.bind(this),rows:this.props.rows}))}}]),b}(React.Component);InputTextarea.defaultProps={rows:5};var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),RulesEditor=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c._onChange=c.onChange.bind(c),c.state={changes:0},c}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){ace.config.set("modePath","/frontend/js/misc/ace/mode/"),this.editor=ace.edit(this.props.name),this.editor.$blockScrolling=1/0,this.editor.getSession().setMode("ace/mode/"+this.props.mode),this.editor.setTheme("ace/theme/"+this.props.theme),this.editor.on("change",this.onChange.bind(this)),this.editor.setValue(this.props.defaultValue||this.props.value,this.props.selectFirstLine===!0?-1:null),this.editor.setOption("maxLines",this.props.maxLines),this.editor.setOption("readOnly",this.props.readOnly),this.editor.setOption("highlightActiveLine",this.props.highlightActiveLine),this.editor.setShowPrintMargin(this.props.setShowPrintMargin),this.editor.getSession().setUseWrapMode(this.props.wrapEnabled),this.editor.renderer.setShowGutter(this.props.showGutter),this.props.onLoad&&this.props.onLoad(this.editor)}},{key:"componentWillReceiveProps",value:function(a){this.editor.selection.getRange();a.key!==this.props.key&&this.editor.setValue(a.defaultValue)}},{key:"onChange",value:function(){if(this.state.changes>0){var a=this.editor.getValue();this.props.onChange(a)}this.setState({changes:this.state.changes+1})}},{key:"render",value:function(){var a={width:this.props.width,height:this.props.height};return React.DOM.div({id:this.props.name,onChange:this._onChange,style:a})}}]),b}(React.Component);RulesEditor.defaultProps={id:"editor",name:"editor",width:"100%",height:"400px",mode:"trd",theme:"monokai",defaultValue:"",value:"",fontSize:12,showGutter:!0,onChange:null,onLoad:null,maxLines:null,readOnly:!1,highlightActiveLine:!0,showPrintMargin:!0,selectFirstLine:!1,wrapEnabled:!1};var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SettingsEditor=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={info:null,activeSection:null},c}return _inherits(b,a),_createClass(b,[{key:"componentWillMount",value:function(){var a=this;fetch("/api/settings",{method:"get"}).then(function(b){return b.json().then(function(b){a.setState({info:b,activeTag:Object.keys(b.tag_options).sort()[0]})})})["catch"](function(a){})}},{key:"loadSiteConfig",value:function(a,b){}},{key:"componentWillUpdate",value:function(a,b){if(null!=this.state.info&&this.state.activeTag==b.activeTag){console.log("Saving");var c=new FormData;c.append("allowed_classifications",this.state.setClassifications),c.append("allowed_countries",this.state.setCountries),fetch("/api/settings/save",{method:"POST",body:JSON.stringify(b.info),headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json; charset=utf-8"}}).then(function(a){return a.json()}).then(function(a){console.log("Saved")})["catch"](function(a){console.log("Error",a)})}}},{key:"onChangeSetting",value:function(a,b){var c=JSON.parse(JSON.stringify(this.state.info));switch(_.has(c,a),a){case"require_pretime":case"always_add_affils":case"dataprovider_needs_approval":case"refresh_ended_shows":case"cleanup_old_pre":case"approved_straight_to_cbftp":var d="true"==b.target.value;_.set(c,a,d);break;case"banned_groups":_.set(c,a,b.target.value.toUpperCase().split(" "));break;case"default_skiplists":case"tags":case"ignore_tags":_.set(c,a,b.target.value.split(" "));break;case"children_networks":_.set(c,a,b.target.value.split(","));break;default:console.log(a,b.target.value),_.set(c,a,b.target.value)}this.setState({info:c})}},{key:"onChangeTag",value:function(a,b){return this.setState({activeTag:a}),b.preventDefault(),!1}},{key:"onDeleteTag",value:function(){}},{key:"addTag",value:function(){var a=prompt("Enter a tag name");if(null!=a&&a.length){if(Object.keys(this.state.info.tag_options).map(Function.prototype.call,String.prototype.toLowerCase).includes(a.toLowerCase()))return void alert("This tag already exists");var b=JSON.parse(JSON.stringify(this.state.info));b.tag_options[a]={data_sources:[],allowed_groups:[],tag_requires:[],tag_skiplist:[]},this.setState({info:b})}}},{key:"onChangeTagOptions",value:function(a,b){var c=JSON.parse(JSON.stringify(this.state.info)),d=a.split(".").slice(-1).pop();switch(d){case"data_sources":_.set(c,a,b.target.value.split(" "));break;case"allowed_groups":_.set(c,a,b.target.value.split(" ").toUpperCase());break;case"tag_requires":case"tag_skiplist":_.set(c,a,b.target.value.split("\n"))}this.setState({info:c})}},{key:"onChangeSchedule",value:function(a,b,c){var d=JSON.parse(JSON.stringify(this.state.info));_.set(d.schedule,a+".["+b+"]",c.target.value),console.log(d),this.setState({info:d})}},{key:"render",value:function(){var a=this;if(null===this.state.info)return React.createElement("div",{id:"site-edit"},"Loading...");var b=Object.keys(this.state.info.tag_options).sortIgnoreCase().map(function(b){var c=(a.state.info.tag_options[b],classNames({active:a.state.activeTag==b}));return React.createElement("li",{key:b,className:c},React.createElement("a",{href:"#",onClick:a.onChangeTag.bind(a,b)},b," ",React.createElement("i",{onClick:a.onDeleteTag.bind(a,b),className:"fa fa-times",style:{"float":"right"}})))}),c=null;if(null!=this.state.activeTag){var d=this.state.info.tag_options[this.state.activeTag];null!=d&&(c=React.createElement(InputTagOption,{key:this.state.activeTag,tag:this.state.activeTag,info:d,onChange:this.onChangeTagOptions.bind(this)}))}this.state.info.children_networks||(this.state.info.children_networks=[]);var e=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(b,c){return React.createElement("tr",{key:b},React.createElement("td",null,b),React.createElement("td",{style:{width:"200px"}},React.createElement("input",{onChange:a.onChangeSchedule.bind(a,c+1,0),type:"text",className:"form-control input-sm",style:{width:"70px",marginRight:0,display:"inline-block"},defaultValue:a.state.info.schedule[c+1][0]})," -",React.createElement("input",{onChange:a.onChangeSchedule.bind(a,c+1,1),type:"text",className:"form-control input-sm",style:{width:"70px",display:"inline-block"},defaultValue:a.state.info.schedule[c+1][1]})))});return React.createElement("div",null,React.createElement("h2",null,"Edit settings"),React.createElement("div",{className:"form-horizontal"},React.createElement("h3",null,"Basic settings"),React.createElement(InputBooleanChoice,{name:"require_pretime",label:"Require pretime?",description:"Bla bla",defaultValue:this.state.info.require_pretime,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputBooleanChoice,{name:"always_add_affils",label:"Always add affil sites to races (where possible)?",description:"Bla bla",defaultValue:this.state.info.always_add_affils,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputText,{name:"data_exchange_channel",label:"Data exchange channel",description:"Bla bla",defaultValue:this.state.info.data_exchange_channel,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputBooleanChoice,{name:"dataprovider_needs_approval",label:"Require approval for all data provider lookups? (NOT WORKING YET)",description:"Bla bla",defaultValue:this.state.info.dataprovider_needs_approval,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputBooleanChoice,{name:"refresh_ended_shows",label:"Refresh data cache for 'Ended' shows?",description:"Bla bla",defaultValue:this.state.info.refresh_ended_shows,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputBooleanChoice,{name:"cleanup_old_pre",label:"Delete pre data older than 30 days?",description:"Bla bla",defaultValue:this.state.info.cleanup_old_pre,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputText,{name:"default_skiplists",label:"Default skiplists (space-seperator)",description:"Bla bla",defaultValue:this.state.info.default_skiplists.sort().join(" "),onChange:this.onChangeSetting.bind(this)}),React.createElement("h3",null,"Bad shit"),React.createElement(InputText,{name:"baddir",label:"Regex to skip bad release names",description:"Bla bla",defaultValue:this.state.info.baddir,onChange:this.onChangeSetting.bind(this),classes:"code"}),React.createElement(InputText,{name:"banned_groups",label:"List of banned groups (space-seperator)",description:"Bla bla",defaultValue:this.state.info.banned_groups.sort().join(" "),onChange:this.onChangeSetting.bind(this)}),React.createElement("h3",null,"Tags (bookmarks)"),React.createElement(InputText,{name:"tags",label:"Tags (space-seperator)",description:"Bla bla",defaultValue:this.state.info.tags.sort().join(" "),onChange:this.onChangeSetting.bind(this)}),React.createElement(InputText,{name:"ignore_tags",label:"Tags to ignore (space-seperator)",description:"Bla bla",defaultValue:this.state.info.ignore_tags.sort().join(" "),onChange:this.onChangeSetting.bind(this)}),React.createElement("h3",null,"Tag options"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement("ul",{className:"nav nav-pills nav-stacked",style:{marginBottom:"1em"}},b),React.createElement("a",{className:"btn btn-block btn-default",onClick:this.addTag.bind(this)},"Add tag")),React.createElement("div",{className:"col-md-9"},c)),React.createElement("h3",null,"Misc. options"),React.createElement(InputText,{name:"children_networks",label:"List of children's networks (comma-seperator)",description:"CBBC,Cartoon Network",defaultValue:this.state.info.children_networks.sort().join(","),onChange:this.onChangeSetting.bind(this)}),React.createElement("h3",null,"cbftp"),React.createElement(InputText,{name:"cbftp_host",label:"Hostname",description:"Hostname",defaultValue:this.state.info.cbftp_host,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputText,{name:"cbftp_port",label:"Port",description:"Port",defaultValue:this.state.info.cbftp_port,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputText,{name:"cbftp_password",label:"UDP password",description:"",defaultValue:this.state.info.cbftp_password,onChange:this.onChangeSetting.bind(this)}),React.createElement(InputBooleanChoice,{name:"approved_straight_to_cbftp",label:"Send approved races straight to cbftp?",description:"Bla bla",defaultValue:this.state.info.approved_straight_to_cbftp,onChange:this.onChangeSetting.bind(this)}),React.createElement("h3",null,"Scheduling"),React.createElement("p",null,"If you enable cbftp integration, you can limit its schedule below so UDP commands are only sent between certain hours."),React.createElement("table",{className:"table table-bordered",style:{width:"auto"}},React.createElement("tbody",null,e))))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SiteEdit=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={info:null,activeSection:null},c}return _inherits(b,a),_createClass(b,[{key:"componentWillMount",value:function(){var a=this;
fetch("/api/site/"+this.props.name,{method:"get"}).then(function(b){return b.json().then(function(b){var c=null;b.sections.length>0&&(c=_.sortBy(b.sections,"name")[0].name),a.setState({info:b,activeSection:c})})})["catch"](function(a){})}},{key:"loadSiteConfig",value:function(a,b){}},{key:"componentWillUpdate",value:function(a,b){null!=this.state.info&&(this.state.activeSection==b.activeSection||this.state.info.sections.length!=b.info.sections.length)&&(console.log("Saving"),fetch("/api/site/"+this.props.name+"/save",{method:"POST",body:JSON.stringify(b.info),headers:new Headers({"Content-Type":"application/json"})}).then(function(a){return a.json()}).then(function(a){console.log("Saved")})["catch"](function(a){console.log("Error saving",a)}))}},{key:"addSection",value:function(){var a=prompt("Enter section (directory) name:");if(null!==a&&a.length){var b=!1;if(_.forOwn(this.state.info.sections,function(c,d){c.name.toLowerCase()==a.toLowerCase()&&(b=!0)}),b)return void alert("Section already exists");var c=JSON.parse(JSON.stringify(this.state.info));c.sections.push({name:a,bnc:null,pretime:60,tags:[],skiplists:[],rules:[],dupeRules:{"source.firstWins":!1,"source.priority":""}}),this.setState({info:c,activeSection:a})}}},{key:"onDeleteSection",value:function(a,b){if(confirm("Are you sure you want to permanently remove this section: "+a+"?")){var c=JSON.parse(JSON.stringify(this.state.info)),d=_.findKey(c.sections,["name",a]);d>=0&&(c.sections.splice(d,1),this.setState({info:c}),a==this.state.activeSection&&this.setState({activeSection:_.sortBy(this.state.info.sections,"name")[0].name}))}b.stopPropagation(),b.preventDefault()}},{key:"onChangeSection",value:function(a,b){return this.setState({activeSection:a}),b.preventDefault(),!1}},{key:"onChangeConfig",value:function(a,b){var c=JSON.parse(JSON.stringify(this.state.info));switch(_.has(c,a),a){case"enabled":case"irc.strings.newstring-isregex":case"irc.strings.endstring-isregex":case"irc.strings.prestring-isregex":_.set(c,a,b.target.checked);break;case"affils":case"banned_groups":var d=b.target.value.toUpperCase();_.set(c,a,d.split(" "));break;default:_.set(c,a,b.target.value)}this.setState({info:c})}},{key:"sortAffils",value:function(){var a=JSON.parse(JSON.stringify(this.state.info));_.set(a,"affils",_.uniq(this.state.info.affils.sort())),this.setState({info:a})}},{key:"sortBannedGroups",value:function(){var a=JSON.parse(JSON.stringify(this.state.info));_.set(a,"banned_groups",_.uniq(this.state.info.banned_groups.sort())),this.setState({info:a})}},{key:"onChangeSectionConfig",value:function(a,b,c){var d=JSON.parse(JSON.stringify(this.state.info)),e=_.findKey(d.sections,["name",a]);if(e>=0){var f=c.target.value;"rules"==b&&(f=c.target.value.split("\n")),d.sections[e][b]=f,this.setState({info:d})}}},{key:"onChangeSectionConfigRules",value:function(a){var b=JSON.parse(JSON.stringify(this.state.info)),c=_.findKey(b.sections,["name",this.state.activeSection]);c>=0&&(a=_.without(a.trim().split("\n"),""),b.sections[c].rules=a,this.setState({info:b}))}},{key:"onChangeSectionDupeRules",value:function(a,b){var c=JSON.parse(JSON.stringify(this.state.info)),d=_.findKey(c.sections,["name",this.state.activeSection]);if(d>=0){switch(a){case"source.firstWins":c.sections[d].dupeRules[a]=b.target.checked;break;case"source.priority":c.sections[d].dupeRules[a]=b.target.value}this.setState({info:c})}}},{key:"onAddTag",value:function(a){var b=prompt("Choose a regex trigger","/.*/i");if(b.length){var c=JSON.parse(JSON.stringify(this.state.info)),d=_.findKey(c.sections,["name",this.state.activeSection]);c.sections[d].tags.push({tag:a,trigger:b,rules:[]}),this.setState({info:c})}}},{key:"onRemoveTag",value:function(a){if(confirm("Are you sure you want to remove this tag?")){var b=JSON.parse(JSON.stringify(this.state.info)),c=_.findKey(b.sections,["name",this.state.activeSection]),d=_.findKey(b.sections[c].tags,["tag",a]);b.sections[c].tags.splice(d,1),this.setState({info:b})}}},{key:"onChangeTag",value:function(a,b){var c=JSON.parse(JSON.stringify(this.state.info)),d=_.findKey(c.sections,["name",this.state.activeSection]),e=_.findKey(c.sections[d].tags,["tag",a]);for(var f in b)if(b.hasOwnProperty(f)){var g=b[f];"rules"==f&&(g=_.without(g.trim().split("\n"),"")),c.sections[d].tags[e][f]=g}this.setState({info:c})}},{key:"onAddSkiplist",value:function(a){var b=JSON.parse(JSON.stringify(this.state.info)),c=_.findKey(b.sections,["name",this.state.activeSection]);-1===this.state.info.sections[c].skiplists.indexOf(a)&&(b.sections[c].skiplists.push(a),this.setState({info:b}))}},{key:"onRemoveSkiplist",value:function(a){var b=JSON.parse(JSON.stringify(this.state.info)),c=_.findKey(b.sections,["name",this.state.activeSection]),d=this.state.info.sections[c].skiplists.indexOf(a);b.sections[c].skiplists.splice(d,1),this.setState({info:b})}},{key:"testAnnounceString",value:function(a){var b=this.state.info,c=_.get(b,a);if(null!==c&&c.length){var d=_.get(b,a+"-section"),e=_.get(b,a+"-rls");if(d&&e&&d.length&&e.length){var f=prompt("Enter a sample string...");f.length&&fetch("/api/site/"+this.props.name+"/testString",{method:"POST",body:JSON.stringify({testString:f,key:a}),headers:new Headers({"Content-Type":"application/json"})}).then(function(a){return a.json()}).then(function(a){a.matched?alert("Matched section: "+a.section+" and rlsname: "+a.rlsname):alert("No match")})["catch"](function(a){console.log("Error saving",a)})}}}},{key:"render",value:function(){var a=this;if(null===this.state.info)return React.createElement("div",{id:"site-edit"},"Loading...");var b=_.sortBy(this.state.info.sections,"name").map(function(b){var c=classNames({active:a.state.activeSection==b.name,notags:0==b.tags.length||"undefined"==typeof b.rules||0==b.rules.length&&0==b.tags.length});return React.createElement("li",{key:b.name,className:c},React.createElement("a",{href:"#",onClick:a.onChangeSection.bind(a,b.name)},b.name," ","(",b.tags.length,")"," ",React.createElement("i",{onClick:a.onDeleteSection.bind(a,b.name),className:"icon-times",style:{"float":"right"}})))}),c=null;if(null!=this.state.activeSection){for(var d=null,e=0;e<this.state.info.sections.length;e++)this.state.info.sections[e].name==this.state.activeSection&&(d=this.state.info.sections[e]);null!=d&&(c=React.createElement(SiteEditSection,{info:d,onChange:this.onChangeSectionConfig.bind(this),onAddTag:this.onAddTag.bind(this),onRemoveTag:this.onRemoveTag.bind(this),onChangeTag:this.onChangeTag.bind(this),onAddSkiplist:this.onAddSkiplist.bind(this),onRemoveSkiplist:this.onRemoveSkiplist.bind(this),onChangeSectionRules:this.onChangeSectionConfigRules.bind(this),onChangeSectionDupeRules:this.onChangeSectionDupeRules.bind(this)}))}return React.createElement("div",{id:"site-edit"},React.createElement("h1",null,"Editing site: ",this.props.name),React.createElement("fieldset",null,React.createElement("legend",null,"Basic Information"," ",React.createElement("a",{"data-help":"sites",className:"pull-right"},React.createElement("i",{className:"icon-question-circle"}))),React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{tabIndex:"1",id:"site-enabled",type:"checkbox",value:"1",defaultChecked:this.state.info.enabled,onChange:this.onChangeConfig.bind(this,"enabled")}),"Enabled?"))),React.createElement("fieldset",null,React.createElement("legend",null,"IRC Configuration"),React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"Channel"),React.createElement("div",{className:"col-sm-4"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Regex to match channel",value:this.state.info.irc.channel,onChange:this.onChangeConfig.bind(this,"irc.channel")}))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"Bot"),React.createElement("div",{className:"col-sm-4"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Regex to match bot",value:this.state.info.irc.bot,onChange:this.onChangeConfig.bind(this,"irc.bot")}))))),React.createElement("fieldset",null,React.createElement("legend",null,"Announce strings"),React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("div",{className:"col-sm-8"}),React.createElement("div",{className:"col-sm-1"},React.createElement("strong",null,"Section")),React.createElement("div",{className:"col-sm-1"},React.createElement("strong",null,"Rlsname")),React.createElement("div",{className:"col-md-2"})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"New string"),React.createElement("div",{className:"col-sm-6"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"e.g. New in &section by &user with &release",value:this.state.info.irc.strings.newstring,onChange:this.onChangeConfig.bind(this,"irc.strings.newstring")})),React.createElement("div",{className:"col-md-1"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Section",value:this.state.info.irc.strings["newstring-section"],onChange:this.onChangeConfig.bind(this,"irc.strings.newstring-section")})),React.createElement("div",{className:"col-md-1"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Rls",value:this.state.info.irc.strings["newstring-rls"],onChange:this.onChangeConfig.bind(this,"irc.strings.newstring-rls")})),React.createElement("div",{className:"col-md-1"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",value:"",defaultChecked:this.state.info.irc.strings["newstring-isregex"],onChange:this.onChangeConfig.bind(this,"irc.strings.newstring-isregex")}),"Regex?"))),React.createElement("div",{className:"col-md-1"},React.createElement("a",{className:"btn btn-default btn-block",onClick:this.testAnnounceString.bind(this,"irc.strings.newstring")},"Test"))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"End string"),React.createElement("div",{className:"col-sm-6"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"e.g. End in &section by &user with &release",value:this.state.info.irc.strings.endstring,onChange:this.onChangeConfig.bind(this,"irc.strings.endstring")})),React.createElement("div",{className:"col-md-1"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Tok #",value:this.state.info.irc.strings["endstring-section"],onChange:this.onChangeConfig.bind(this,"irc.strings.endstring-section")})),React.createElement("div",{className:"col-md-1"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Tok #",value:this.state.info.irc.strings["endstring-rls"],onChange:this.onChangeConfig.bind(this,"irc.strings.endstring-rls")})),React.createElement("div",{className:"col-md-1"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",value:"",defaultChecked:this.state.info.irc.strings["endstring-isregex"],onChange:this.onChangeConfig.bind(this,"irc.strings.endstring-isregex")}),"Regex?"))),React.createElement("div",{className:"col-md-1"},React.createElement("a",{className:"btn btn-default btn-block",onClick:this.testAnnounceString.bind(this,"irc.strings.endstring")},"Test"))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"Pre string"),React.createElement("div",{className:"col-sm-6"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"e.g. Pre in &section by &user with &release",value:this.state.info.irc.strings.prestring,onChange:this.onChangeConfig.bind(this,"irc.strings.prestring")})),React.createElement("div",{className:"col-md-1"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Tok #",value:this.state.info.irc.strings["prestring-section"],onChange:this.onChangeConfig.bind(this,"irc.strings.prestring-section")})),React.createElement("div",{className:"col-md-1"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"Tok #",value:this.state.info.irc.strings["prestring-rls"],onChange:this.onChangeConfig.bind(this,"irc.strings.prestring-rls")})),React.createElement("div",{className:"col-md-1"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",value:"",defaultChecked:this.state.info.irc.strings["prestring-isregex"],onChange:this.onChangeConfig.bind(this,"irc.strings.prestring-isregex")}),"Regex?"))),React.createElement("div",{className:"col-md-1"},React.createElement("a",{className:"btn btn-default btn-block",onClick:this.testAnnounceString.bind(this,"irc.strings.prestring")},"Test"))))),React.createElement("fieldset",null,React.createElement("legend",null,"Groups"),React.createElement("div",{className:"form-horizontal"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"Affils"),React.createElement("div",{className:"col-sm-9"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"List of affils (seperated by spaces)",value:this.state.info.affils.join(" "),onChange:this.onChangeConfig.bind(this,"affils"),style:{textTransform:"uppercase"}})),React.createElement("div",{className:"col-sm-1"},React.createElement("a",{className:"btn btn-default",onClick:this.sortAffils.bind(this)},"Sort A-Z"))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"inputEmail3",className:"col-sm-2 control-label"},"Banned groups"),React.createElement("div",{className:"col-sm-9"},React.createElement("input",{type:"text",className:"form-control",id:"inputEmail3",placeholder:"List of banned groups (seperated by spaces)",value:this.state.info.banned_groups.join(" "),onChange:this.onChangeConfig.bind(this,"banned_groups"),style:{textTransform:"uppercase"}})),React.createElement("div",{className:"col-sm-1"},React.createElement("a",{className:"btn btn-default",onClick:this.sortBannedGroups.bind(this)},"Sort A-Z"))))),React.createElement("fieldset",null,React.createElement("legend",null,"Sections"),React.createElement("div",{className:"row"},React.createElement("div",{className:"col-md-3"},React.createElement("ul",{className:"nav nav-pills nav-stacked",style:{marginBottom:"1em"}},b),React.createElement("a",{className:"btn btn-block btn-default",onClick:this.addSection.bind(this)},"Add section")),React.createElement("div",{className:"col-md-9"},c))))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SiteEditSection=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={tags:[],skiplists:[],activeTab:"general",editingTag:null},c}return _inherits(b,a),_createClass(b,[{key:"componentWillMount",value:function(){var a=this;fetch("/api/section",{method:"get"}).then(function(b){return b.json().then(function(b){a.setState({tags:b})})})["catch"](function(a){}),fetch("/api/skiplist",{method:"get"}).then(function(b){return b.json().then(function(b){a.setState({skiplists:b})})})["catch"](function(a){})}},{key:"componentWillReceiveProps",value:function(a){this.props.info.name!=a.info.name&&this.setState({editingTag:null})}},{key:"onChangeTab",value:function(a,b){this.setState({activeTab:a}),b.preventDefault()}},{key:"onChooseTagToEdit",value:function(a,b){this.setState({editingTag:a})}},{key:"onToggleTag",value:function(a,b){0==b?this.props.onRemoveTag(a):this.props.onAddTag(a)}},{key:"onChangeTrigger",value:function(a){this.props.onChangeTag(this.state.editingTag,{trigger:a.target.value})}},{key:"onChangeTagRule",value:function(a){this.props.onChangeTag(this.state.editingTag,{rules:a})}},{key:"onToggleSkiplist",value:function(a,b){0==b?this.props.onRemoveSkiplist(a):this.props.onAddSkiplist(a)}},{key:"render",value:function(){var a=this,b=null;this.state.tags.length&&(b=this.state.tags.map(function(b){for(var c=React.createElement("i",{className:"icon-times",style:{color:"#666"},onClick:a.onToggleTag.bind(a,b,!0)}),d=null,e=0;e<a.props.info.tags.length;e++)a.props.info.tags[e].tag==b&&(c=React.createElement("i",{className:"icon-check",style:{color:"#00E500"},onClick:a.onToggleTag.bind(a,b,!1)}),d=React.createElement("span",null," - ",React.createElement("a",{onClick:a.onChooseTagToEdit.bind(a,b)},"[Edit]")));return React.createElement("div",{className:"col-md-4",key:b},c," ",b," ",d)}));var c=null;Object.keys(this.state.skiplists).length&&(c=Object.keys(this.state.skiplists).map(function(b){for(var c=React.createElement("i",{className:"icon-times",style:{color:"#666"},onClick:a.onToggleSkiplist.bind(a,b,!0)}),d=0;d<a.props.info.skiplists.length;d++)a.props.info.skiplists[d]==b&&(c=React.createElement("i",{className:"icon-check",style:{color:"#00E500"},onClick:a.onToggleSkiplist.bind(a,b,!1)}));return React.createElement("div",{className:"col-md-4",key:b},c," ",b)}));var d=null;if(null!==this.state.editingTag){var e=_.findKey(this.props.info.tags,["tag",this.state.editingTag]),f=this.props.info.tags[e].trigger;d=React.createElement("div",{style:{marginTop:"1em"}},React.createElement("label",{htmlFor:"exampleInputName2"},"Trigger for ",this.state.editingTag,":"),React.createElement("div",{className:"form-group"},React.createElement("input",{type:"text",className:"form-control",id:"exampleInputName2",placeholder:"trigger..",size:"6",value:f,onChange:this.onChangeTrigger.bind(this)})))}var g=null;if(null!==this.state.editingTag){var e=_.findKey(this.props.info.tags,["tag",this.state.editingTag]),h=this.props.info.tags[e].rules;"undefined"!=typeof h&&h.length&&(h=h.join("\n")),g=React.createElement("div",{style:{marginTop:"1em"}},React.createElement("label",null,"Rules for ",this.state.editingTag,":"),React.createElement("div",{className:"form-group"},React.createElement(RulesEditor,{defaultValue:h,onChange:this.onChangeTagRule.bind(this),key:this.props.info.name+this.state.editingTag})))}var i=["general","tags","rules","dupes","skiplists"],j=[],k=i.map(function(b){var c=b.charAt(0).toUpperCase()+b.slice(1),d="";"rules"==b&&"undefined"!=typeof a.props.info.rules?d=React.createElement("span",{className:"badge"},a.props.info.rules.length):"tags"==b&&"undefined"!=typeof a.props.info.tags?d=React.createElement("span",{className:"badge"},a.props.info.tags.length):"skiplists"==b&&"undefined"!=typeof a.props.info.skiplists&&(d=React.createElement("span",{className:"badge"},a.props.info.skiplists.length));var e=classNames({active:a.state.activeTab==b});return j[b]=classNames({"tab-panel":!0,"tab-panel-visible":a.state.activeTab==b}),React.createElement("li",{className:e,key:b,role:"presentation","data-toggle":"general"},React.createElement("a",{href:"#",onClick:a.onChangeTab.bind(a,b)},c," ",d))}),h="";"undefined"!=typeof this.props.info.rules&&(h=this.props.info.rules.join("\n"));var l=(this.props.info.dupeRules["source.firstWins"],null);if(this.props.info.dupeRules["source.priority"]&&this.props.info.dupeRules["source.priority"].length){var m=this.props.info.dupeRules["source.priority"].split(",");m.length>=2&&(l="Firstly "+m[0]+" is allowed, followed by "+m.slice(1).join(", "))}return React.createElement("div",null,React.createElement("ul",{className:"nav nav-tabs",id:"section-tabs"},k),React.createElement("div",{className:"well well-tag"},React.createElement("div",{id:"general",className:j.general},React.createElement("div",{className:"form-inline"},React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"exampleInputName2"},"Pretime (min.)"),React.createElement("input",{type:"text",className:"form-control",id:"exampleInputName2",placeholder:"300",size:"6",onChange:this.props.onChange.bind(this,this.props.info.name,"pretime"),value:this.props.info.pretime})),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"exampleInputEmail2"},"BNC"),React.createElement("input",{type:"type",className:"form-control",id:"exampleInputEmail2",placeholder:"",onChange:this.props.onChange.bind(this,this.props.info.name,"bnc"),value:this.props.info.bnc})))),React.createElement("div",{id:"tags",className:j.tags},React.createElement("div",{className:""},React.createElement("label",{htmlFor:"exampleInputName2"},"Choose tags:"),React.createElement("div",{className:"row"},b),d,g)),React.createElement("div",{id:"rules",className:j.rules},React.createElement("div",{className:""},React.createElement("label",{htmlFor:"exampleInputName2",style:{display:"block"}},"Rules"),React.createElement(RulesEditor,{key:this.props.info.name,defaultValue:h,onChange:this.props.onChangeSectionRules.bind(this)}))),React.createElement("div",{id:"dupes",className:j.dupes},React.createElement("div",{className:""},React.createElement("label",{htmlFor:"exampleInputName2",style:{display:"block"}},"Source rules (only use on TV sections):"),React.createElement("div",{className:"form-group"},React.createElement("div",{className:"checkbox"},React.createElement("label",null,React.createElement("input",{type:"checkbox",checked:this.props.info.dupeRules["source.firstWins"],defaultChecked:this.props.info.dupeRules["source.firstWins"],onClick:this.props.onChangeSectionDupeRules.bind(this,"source.firstWins")})," First on site wins?"))),React.createElement("div",{className:"form-group"},React.createElement("label",{htmlFor:"exampleInputEmail2"},"Priority:"),React.createElement("input",{type:"type",className:"form-control",id:"exampleInputEmail2",placeholder:"",onChange:this.props.onChangeSectionDupeRules.bind(this,"source.priority"),value:this.props.info.dupeRules["source.priority"]}),this.props.info.dupeRules["source.priority"]&&React.createElement("span",{className:"help-block"},l,">")))),React.createElement("div",{id:"skiplists",className:j.skiplists},React.createElement("div",{className:""},React.createElement("label",{htmlFor:""},"Choose skiplists:"),React.createElement("div",{className:"row"},c)))))}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SkiplistEdit=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={skiplists:{}},c}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=this;fetch("/api/skiplist/",{method:"get"}).then(function(b){return b.json().then(function(b){a.setState({skiplists:b,loaded:!0})})})["catch"](function(a){})}},{key:"componentWillUpdate",value:function(a,b){null!=this.state.skiplists&&(console.log("Saving"),fetch("/api/skiplist/save",{method:"POST",body:JSON.stringify(b.skiplists),headers:new Headers({"Content-Type":"application/json"})}).then(function(a){return a.json()}).then(function(a){console.log("Saved")})["catch"](function(a){console.log("Error saving",a)}))}},{key:"componentDidUpdate",value:function(a,b){b.loaded===!1}},{key:"_checkItemDoesntExist",value:function(a){}},{key:"addNormal",value:function(){var a=prompt("Enter a unique name for this item skiplist (a-z0-9_)");if(a.length){if(_.has(this.state.skiplists,a))return alert("An item with this name already exists");var b=this.state.skiplists;b[a]={items:[],shared:!0},this.setState({skiplists:b})}else alert("You didn't enter anything")}},{key:"addRegex",value:function(){var a=prompt("Enter a unique name for this regex skiplist (a-z0-9_)");if(a.length){if(_.has(this.state.skiplists,a))return alert("An item with this name already exists");var b=this.state.skiplists;b[a]={regex:"",shared:!0},this.setState({skiplists:b})}else alert("You didn't enter anything")}},{key:"changeItem",value:function(a,b,c){var d=JSON.parse(JSON.stringify(this.state.skiplists)),e={shared:!0};"regex"==a?e.regex=c.target.value:e.items=c.target.value.split("\n"),_.set(d,b,e),this.setState({skiplists:d})}},{key:"deleteItem",value:function(a,b){if(confirm('Are you sure you want to delete the skiplist "'+a+'"?')){var c=JSON.parse(JSON.stringify(this.state.skiplists));delete c[a],this.setState({skiplists:c})}}},{key:"render",value:function(){var a=this;console.log(this.state);var b=null;return Object.keys(this.state.skiplists).length&&(b=Object.keys(this.state.skiplists).map(function(b){var c=null,d=null;if("undefined"!=typeof a.state.skiplists[b].items)var c=React.createElement(SkiplistItems,{name:b,items:a.state.skiplists[b].items,onChange:a.changeItem.bind(a)});else{var c=React.createElement(SkiplistItemRegex,{name:b,regex:a.state.skiplists[b].regex,onChange:a.changeItem.bind(a)});d=React.createElement("span",null," (regex)")}return React.createElement("div",{className:"row",key:b},React.createElement("div",{className:"col-md-3"},React.createElement("i",{className:"icon-trash-o",onClick:a.deleteItem.bind(a,b)})," ",React.createElement("strong",null,b," ",d)),React.createElement("div",{className:"col-md-9"},c,React.createElement("br",null)))})),React.createElement("div",{className:"well"},React.createElement("h3",null,"Skiplists ",React.createElement("a",{className:"pull-right","data-help":"skiplists"},React.createElement("i",{className:"icon-question-circle"}))),React.createElement("p",null,React.createElement("a",{className:"btn btn-primary",onClick:this.addRegex.bind(this)},"Add regex item")," ",React.createElement("a",{className:"btn btn-primary",onClick:this.addNormal.bind(this)},"Add wildcard item")),b)}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SkiplistItemRegex=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={},c}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){return React.createElement("textarea",{type:"text",className:"form-control",rows:10,defaultValue:this.props.regex,onChange:this.props.onChange.bind(this,"regex",this.props.name)})}}]),b}(React.Component),_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),SkiplistItems=function(a){function b(a){_classCallCheck(this,b);var c=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.state={},c}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){var a=this.props.items.join("\n"),b={width:"100%"};return React.createElement("textarea",{className:"form-control",style:b,rows:10,defaultValue:a,onChange:this.props.onChange.bind(this,"items",this.props.name)})}}]),b}(React.Component);if(window.location.pathname.match(/site\/.*?\/edit/i)&&(window.onload=function(){var a=document.getElementById("site-edit").getAttribute("data-site");ReactDOM.render(React.createElement(SiteEdit,{name:a}),document.getElementById("site-edit"))}),window.location.pathname.match(/^\/auto\//i)){var site=document.getElementById("auto-settings-filter").getAttribute("data-section");ReactDOM.render(React.createElement(AutoSettings,{section:site}),document.getElementById("auto-settings-filter"))}window.location.pathname.match(/^\/skiplist\/list/i)&&ReactDOM.render(React.createElement(SkiplistEdit,null),document.getElementById("skiplist-edit")),window.location.pathname.match(/^\/settings\/edit/i)&&ReactDOM.render(React.createElement(SettingsEditor,null),document.getElementById("settings-edit")),window.location.pathname.match(/^\/autorules/i)&&ReactDOM.render(React.createElement(AutoRules,null),document.getElementById("autorules-edit")),live("click","[data-help]",function(a){var b=a.target.parentNode.getAttribute("data-help");showHelp(b)}),document.querySelector("#help .close").onclick=hideHelp,Array.prototype.sortIgnoreCase||(Array.prototype.sortIgnoreCase=function(){return this.sort(function(a,b){return a.toLowerCase().localeCompare(b.toLowerCase())})});